---
title: 模糊查询，一个值查询多个字段（数据库字段没有做分词的设计情况）
date: 2018-06-22 18:32:50
categories:
	- java
tags:
	- 备忘代码
---

##### 接口

```
@ApiOperation(value = "搜索酒店类型的外联人", notes = "查询酒店类型的外联人", httpMethod = "POST", response = Object.class)
    @ApiImplicitParams({
        @ApiImplicitParam(name = "params", readOnly = true, value = "", dataType = "String", paramType = "query"),
        @ApiImplicitParam(name = "keyWord", value = "关键字查询", required = false, dataType = "String", paramType = "query"),
        @ApiImplicitParam(name = "pageNumber", required = false, dataType = "String", paramType = "query"),
        @ApiImplicitParam(name = "pageSize", required = false, dataType = "String", paramType = "query"),
    })
    @RequestMapping(value = "/searchContactsList", method = RequestMethod.POST)
    public @ResponseBody
    String searchContactsList(@RequestBody Map<String, String> params) {
        String ret = "";
        try {
            String cardUrl = getCardUrl();
            if (params.containsKey("cardUrl") && StringUtils.isNotEmpty(params.get("cardUrl"))) {
                cardUrl = params.get("cardUrl");
            }
            String companyId = getCompanyId();
            if (!params.containsKey("companyId") || StringUtils.isEmpty(params.get("companyId"))) {
                params.put("companyId", companyId);
            }
            if (StringUtils.isNotEmpty(cardUrl) && StringUtils.isNotEmpty(companyId)) {
                Map retMap = externalContactsInfoService.searchContactsList(params, companyId);
                ret = JsonUtils.genUpdateDataReturnJsonStr(true, "搜索成功", retMap);
            } else {
                ret = JsonUtils.genUpdateDataReturnJsonStr(false, "cardUrl或者companyId为空");
            }
        } catch (Exception e) {
            LogUtil.error(e);
        }


        return ret;
    }
```
##### 调用的Service

```
    /*
    * 搜索酒店外联人
    * */
    public Map searchContactsList(Map param, String companyId) throws Exception {
        Map map = new HashMap();
        // 按更新时间降序
        Map<String, SortOrder> sortMap = new HashMap<>();
        sortMap.put("genTime", SortOrder.DESC);
        String keyWord = param.get("keyWord").toString();
        String json = "{\"bool\":{\"must\":[{\"term\":{\"companyId\":\"%companyId%\"}},{\"term\":{\"contactsType\":\"酒店客户\"}}],\n" +
            "\t\t\t\t\t\t\t\"must_not\": [{\"term\": {\"isDel\": \"true\"}}],\n" +
            "\t\t\t\t\t\t\t\"should\":[{\"wildcard\":{\"contactsName\":\"*%keyword%*\"}},{\"wildcard\":{\"telPhone\":\"*%keyword%*\"}}],\n" +
            "\t\t\t\t\t\t\t\"minimum_should_match\":1}}";
        json = json.replace("%companyId%", companyId).replace("%keyword%", keyWord);
        map = ESUtil.queryList(Constants.INDEX_HOTEL,
            Constants.HOTEL_CONTACTSINFO, json,
            Integer.parseInt((String) param.get("pageNumber")) - 1,
            Integer.parseInt((String) param.get("pageSize")), sortMap, companyId);
        return map;
    }
```

