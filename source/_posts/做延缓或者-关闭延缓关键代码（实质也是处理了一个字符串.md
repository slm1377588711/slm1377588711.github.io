---
layout: w
title: 做延缓或者 关闭延缓关键代码（实质也是处理了一个字符串)
date: 2018-06-22 18:29:29
categories:
	- java
tags:
	- 处理字符串
---
描述：

延缓操作，就是把待审批的人的字段值移至延缓人字段中
 
```
//存放审批人的list
List<String> workflowWaitPersonNew = new ArrayList();
 //存放延缓人的list
List<String> workflowDelayNew = new ArrayList();

retMap = ESUtil.selectOneRowEE(Constants.INDEX_WORKFLOW,Constants.ES_TYPE_WORKFLOW_WrokflowTable,queryMap,null,companyId,null);
        //待审批人 workflowWaitPerson
        if(retMap.containsKey("workflowWaitPerson") && StringUtils.isNotEmpty(retMap.get("workflowWaitPerson").toString())) {
            String workflowWaitPerson = retMap.get("workflowWaitPerson").toString();
            String[] workflowPersonArr = workflowWaitPerson.split(" ");
            workflowWaitPersonNew = new ArrayList(Arrays.asList(workflowPersonArr));
        }
        //做延缓的人
        if(retMap.containsKey("workflowDelayPerson") && StringUtils.isNotEmpty(retMap.get("workflowDelayPerson").toString())){
            String workflowDelayPerson = retMap.get("workflowDelayPerson").toString();
            String [] workflowDelayarr = workflowDelayPerson.split(" ");
            workflowDelayNew = new ArrayList(Arrays.asList(workflowDelayarr));
        }

        if (param.containsKey("type") && StringUtils.isNotEmpty(param.get("type"))){
                //1. goYH 需要一个审批流Id，查询到 待我审批的值，做删除，并把我的cardUrl加到延缓人字段里
                if("goYH".equals(param.get("type"))) {
                    //如果审批人长度大于零，则循环 用当前cardUrl对比数据，如果等于，则移除
                    if(workflowWaitPersonNew.size()>0){
                        for(String ss : workflowWaitPersonNew){
                            if (ss.equals(param.get("cardUrl"))){
                                workflowWaitPersonNew.remove(ss);
                                break;
                            }
                        }
                    }
                    //如果查到的有延缓人，则判断，是否存在当前cardUrl,如果，不存在，则追加当前cardUrl
                    //如果没有延缓人，则直接追加当前cardUrl
                    if(workflowDelayNew.size()>0){
                        if (!workflowDelayNew.contains(param.get("cardUrl"))){
                            workflowDelayNew.add(param.get("cardUrl"));
                        }
                    }else{
                        workflowDelayNew.add(param.get("cardUrl"));
                    }
                }else{
                    //2. 关闭延缓 需要一个审批流Id，查询到 延缓值，做删除，并把我的cardUrl加到审批人字段里
                   //删除延缓的值
                    if(workflowDelayNew.size()>0){
                        for(String ss : workflowDelayNew){
                            if (ss.equals(param.get("cardUrl"))){
                                workflowDelayNew.remove(ss);
                                break;
                            }
                        }
                    }
                    //添加待审批人的值
                    if(workflowWaitPersonNew.size()>0){
                        if (!workflowWaitPersonNew.contains(param.get("cardUrl"))){
                            workflowWaitPersonNew.add(param.get("cardUrl"));
                        }
                    }else{
                        workflowWaitPersonNew.add(param.get("cardUrl"));
                    }
                }
                String workflowDelayPerson = StringUtils.join(workflowDelayNew.toArray(), " ");
                String workflowWaitPerson = StringUtils.join(workflowWaitPersonNew.toArray(), " ");
                Map updataMap = new HashMap();
                updataMap.put("workflowDelayPerson",workflowDelayPerson);
                updataMap.put("workflowWaitPerson",workflowWaitPerson);
                updataMap.put("rowId",param.get("workflowId"));
                //修改
                ParamCUDES para = new ParamCUDES();
                para.index = Constants.INDEX_WORKFLOW;
                para.type = Constants.ES_TYPE_WORKFLOW_WrokflowTable;
                para.routing = companyId;
                para.row = updataMap;
                para.id = (String)updataMap.get("rowId");
                ESUtil.updateEE(para);
        }
```
